# Set Working Directory
setwd("/home/cmcouto-silva/cmcouto.silva@usp.br/R/packages/gdstat")
# Load R scripts from package
devtools::document()
devtools::load_all()
# Load .bim / .frq.strat files
bim.frq <- load_bim_frq(file_path = "inst/extdata/laclactase_grch37")
# Load .bim / .frq.strat files
bim.frq <- load_bim_frq(file_path = "inst/extdata/lactase_grch37")
# PBS for individuals SNPs
pbs <- pbs_fst(geno.info = bim.frq, focal = "EUR", close = "EAS", outgroup = "AFR")
# PBS for mean of SNPs
pbs_mean <- sliding_window_mean_dt(pbs, 'PBS')
pbs_mean_peaks <- get_peaks2(pbs_mean)
pbs_mean_peaks <- get_peaks(pbs_mean)
pbs_mean_peaks
pbs_mean_peaks[, GENE := sapply(GENE, function(.){
genes <- unlist(strsplit(., ","))
genes <- genes[!grepl("LOC", genes)]
paste(genes, collapse = ",")
})]
gt::see(pbs_mean_peaks)
# Plot only max peak values by chromosome
mplot +
ggrepel::geom_label_repel(data = maxv_per_chr, mapping = aes(x = position, y = PBS),
label = maxv_per_chr[, GENE], size = 3L, vjust = 1)
mplot <- manhattan_plot(pbs_data = pbs_mean, col_name = 'PBS', fig_name = 'pbs_mean.png')
pbs_plot <- pbs_dt[CHR == 2 & POS == 163153981][, GENE := snp.annot(SNP)]
# Plot only max peak values by chromosome
mplot +
ggrepel::geom_label_repel(data = maxv_per_chr, mapping = aes(x = position, y = PBS),
label = maxv_per_chr[, GENE], size = 3L, vjust = 1)
keys <- .
pbs_mean_peaks[17]
gt::see(pbs_mean_peaks)
pbs_plot <- pbs_dt[CHR == 2 & POS == 163153981][, GENE := snp.annot(SNP)]
setkey(all_peakv, CHR, CM, POS, SNP, PBS)
setkey(mplot$data, CHR, CM, POS, SNP, PBS)
setkey(maxv_per_chr, CHR, CM, POS, SNP, PBS)
pbs
pbs_mean
pbs_mean_peaks
pbs_mean_peaks[, GENE := sapply(GENE, function(.){
genes <- unlist(strsplit(., ","))
genes <- genes[!grepl("LOC", genes)]
paste(genes, collapse = ",")
})]
pbs_mean_peaks
setkey(all_peakv, CHR, CM, POS, SNP, PBS)
maxv_per_chr <- pbs_mean_peaks[pbs_mean_peaks[, .I[which.max(PBS)], by = CHR]$V1]
maxv_per_chr <- maxv_per_chr[mplot$data][!is.na(GENE)]
mplot$data
maxv_per_chr[mplot$data]
mplot$data
mplot$data
all_peakv <- copy(pbs_mean_peaks)
all_peakv
all_peakv <- all_peakv[mplot$data][!is.na(GENE)]
all_peakv <- all_peakv[all_peakv[, .I[which.max(PBS)], by = GENE]$V1]
all_peakv
setkey(all_peakv, CHR, CM, POS, SNP, PBS)
setkey(mplot$data, CHR, CM, POS, SNP, PBS)
setkey(maxv_per_chr, CHR, CM, POS, SNP, PBS)
# Plot only max peak values by chromosome
mplot +
ggrepel::geom_label_repel(data = maxv_per_chr, mapping = aes(x = position, y = PBS),
label = maxv_per_chr[, GENE], size = 3L, vjust = 1)
maxv_per_chr
mplot <- manhattan_plot(pbs_data = pbs_mean, col_name = 'PBS', fig_name = 'pbs_mean.png')
maxv_per_chr <- pbs_mean_peaks[pbs_mean_peaks[, .I[which.max(PBS)], by = CHR]$V1]
maxv_per_chr
setkey(all_peakv, CHR, CM, POS, SNP, PBS)
setkey(mplot$data, CHR, CM, POS, SNP, PBS)
setkey(maxv_per_chr, CHR, CM, POS, SNP, PBS)
all_peakv <- copy(pbs_mean_peaks)
setkey(all_peakv, CHR, CM, POS, SNP, PBS)
setkey(mplot$data, CHR, CM, POS, SNP, PBS)
setkey(maxv_per_chr, CHR, CM, POS, SNP, PBS)
all_peakv <- all_peakv[mplot$data][!is.na(GENE)]
all_peakv <- all_peakv[all_peakv[, .I[which.max(PBS)], by = GENE]$V1]
all_peakv
all_peakv <- copy(pbs_mean_peaks)
setkey(all_peakv, CHR, CM, POS, SNP, PBS)
setkey(mplot$data, CHR, CM, POS, SNP, PBS)
setkey(maxv_per_chr, CHR, CM, POS, SNP, PBS)
all_peakv <- all_peakv[mplot$data][!is.na(GENE)]
all_peakv <- all_peakv[all_peakv[, .I[which.max(PBS)], by = GENE]$V1]
maxv_per_chr <- pbs_mean_peaks[pbs_mean_peaks[, .I[which.max(PBS)], by = CHR]$V1]
maxv_per_chr <- maxv_per_chr[mplot$data][!is.na(GENE)]
maxv_per_chr <- pbs_mean_peaks[pbs_mean_peaks[, .I[which.max(PBS)], by = CHR]$V1]
setkey(all_peakv, CHR, CM, POS, SNP, PBS)
setkey(mplot$data, CHR, CM, POS, SNP, PBS)
setkey(maxv_per_chr, CHR, CM, POS, SNP, PBS)
maxv_per_chr <- maxv_per_chr[mplot$data][!is.na(GENE)]
maxv_per_chr <- pbs_mean_peaks[pbs_mean_peaks[, .I[which.max(PBS)], by = CHR]$V1]
setkey(all_peakv, CHR, CM, POS, SNP, PBS)
setkey(mplot$data, CHR, CM, POS, SNP, PBS)
setkey(maxv_per_chr, CHR, CM, POS, SNP, PBS)
maxv_per_chr <- maxv_per_chr[mplot$data][!is.na(GENE)]
all_peakv <- copy(pbs_mean_peaks)
setkey(all_peakv, CHR, CM, POS, SNP, PBS)
setkey(mplot$data, CHR, CM, POS, SNP, PBS)
setkey(maxv_per_chr, CHR, CM, POS, SNP, PBS)
all_peakv <- all_peakv[mplot$data][!is.na(GENE)]
all_peakv <- all_peakv[all_peakv[, .I[which.max(PBS)], by = GENE]$V1]
# Plot only max peak values by chromosome
mplot +
ggrepel::geom_label_repel(data = maxv_per_chr, mapping = aes(x = position, y = PBS),
label = maxv_per_chr[, GENE], size = 3L, vjust = 1)
# Plot all peak values
mplot +
ggrepel::geom_text_repel(data = all_peakv, mapping = aes(x = position, y = PBS),
label = all_peakv[, GENE], size = 2.5,
vjust = 0.5, nudge_x = -0.35)
pbs_mean_peaks
pbs_mean
pbs_mean_peaks <- get_peaks(pbs_mean, quantile = 0.995)
pbs_mean_peaks
# PBS for mean of SNPs
pbs_mean <- sliding_window_mean_dt(pbs, 'PBS')
pbs_mean_peaks <- get_peaks(pbs_mean)
pbs_mean_peaks
pbs_mean_peaks <- get_peaks(pbs_mean, quantile = 0.995)
pbs_mean_peaks[, GENE := sapply(GENE, function(.){
genes <- unlist(strsplit(., ","))
genes <- genes[!grepl("LOC", genes)]
paste(genes, collapse = ",")
})]
pbs_mean_peaks
pbs_mean_peaks[CHR == 2, unique(PBS)]
pbs_mean_peaks[CHR == 2, GENE]
